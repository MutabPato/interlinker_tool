{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{% block title %}Interlinker ‚Äî Internal Link Automation{% endblock %}</title>
    <meta name="description" content="{% block meta_description %}Interlinker ingests your sitemap and automatically inserts relevant internal links into long-form content.{% endblock %}" />
    <meta name="robots" content="index,follow" />
    <link rel="canonical" href="{{ request.scheme }}://{{ request.get_host }}{{ request.path }}" />
    <meta property="og:title" content="{% block og_title %}Interlinker ‚Äî Internal Link Automation{% endblock %}" />
    <meta property="og:description" content="{% block og_description %}Automate contextual internal linking for better SEO and user experience.{% endblock %}" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="{{ request.build_absolute_uri|default_if_none:'' }}" />
    <meta property="og:site_name" content="Interlinker" />
    <meta name="twitter:card" content="summary" />
    <link rel="stylesheet" href="{% static 'css/style.css' %}" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" />
    <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "SoftwareApplication",
            "name": "Interlinker",
            "applicationCategory": "SEO Tool",
            "operatingSystem": "Web",
            "description": "A Django application that ingests sitemaps and automatically inserts internal links into long-form content.",
            "url": "{{ request.scheme }}://{{ request.get_host }}",
            "offers": {
                "@type": "Offer",
                "price": "0",
                "priceCurrency": "USD"
            }
        }
    </script>
    <script>
        (function () {
            var storageKey = 'interlinker-theme';
            var root = document.documentElement;
            try {
                var stored = localStorage.getItem(storageKey);
                if (stored === 'light' || stored === 'dark') {
                    root.dataset.theme = stored;
                    return;
                }
            } catch (err) {
                // localStorage may be unavailable; ignore and fall back to system preference.
            }
            if (!root.dataset.theme && window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                root.dataset.theme = 'dark';
            }
        })();
    </script>
    {% block extra_head %}{% endblock %}
</head>
<body>
    <a class="skip-link" href="#main-content">Skip to content</a>
    <header class="site-header">
        <div class="container header-inner">
            <a class="brand" href="{% url 'interlinker:home' %}">
                <span aria-hidden="true">üï∏Ô∏è</span>
                <span>Interlinker</span>
            </a>
            <nav class="primary-nav" aria-label="Primary">
                <ul>
                    <li><a href="{% url 'interlinker:home' %}">Home</a></li>
                    <li><a href="{% url 'interlinker:sitemap_upload' %}">Upload Sitemap</a></li>
                    <li><a href="{% url 'interlinker:sitemap_links' %}">Links</a></li>
                    {% if request.user.is_authenticated %}
                        <li><a href="{% url 'interlinker:history' %}">History</a></li>
                        <li><a class="cta" href="{% url 'interlinker:interlink' %}">Interlink Content</a></li>
                        <li class="account-chip">
                            <span aria-hidden="true">üë§</span>
                            <span class="visually-hidden">Signed in as </span>{{ request.user.username }}
                        </li>
                        <li><a href="{% url 'logout' %}">Sign out</a></li>
                    {% else %}
                        <li><a href="{% url 'login' %}">Sign in</a></li>
                        <li><a class="cta" href="{% url 'interlinker:signup' %}">Create account</a></li>
                    {% endif %}
                    <li class="theme-toggle-item">
                        <button type="button" class="theme-toggle" data-theme-toggle aria-pressed="false">
                            <span class="icon" aria-hidden="true">üåû</span>
                            <span class="label">Light</span>
                        </button>
                    </li>
                </ul>
            </nav>
        </div>
    </header>
    {% if messages %}
    <div class="container">
        <ul class="messages" role="status">
        {% for message in messages %}
            <li class="message {{ message.tags }}">{{ message }}</li>
        {% endfor %}
        </ul>
    </div>
    {% endif %}
    <main id="main-content" class="site-main" tabindex="-1">
        <div class="container">
            {% block content %}{% endblock %}
        </div>
    </main>
    <footer class="site-footer">
        <div class="container footer-inner">
            <div>
                <p class="brand-foot">Interlinker</p>
                <p>Automating internal links so your readers and search engines never miss the good stuff.</p>
            </div>
            <div class="footer-links">
                <a href="{% url 'interlinker:sitemap_upload' %}">Import sitemap</a>
                <a href="{% url 'interlinker:interlink' %}">Interlink content</a>
                <a href="{% url 'interlinker:sitemap_links' %}">Browse links</a>
                <a href="{% url 'interlinker:privacy' %}">Privacy policy</a>
            </div>
            <div class="footer-meta">
                <p>&copy; {% now 'Y' %} Interlinker. Built with Django.</p>
                <p><a href="mailto:hello@example.com">Contact</a></p>
            </div>
        </div>
    </footer>
    <div id="loading-indicator" class="loading-indicator" aria-hidden="true">
        <div class="loading-indicator__backdrop" aria-hidden="true"></div>
        <div class="loading-indicator__inner" role="status" aria-live="polite">
            <div class="loading-indicator__label">Processing‚Ä¶</div>
            <div class="loading-indicator__track" aria-hidden="true">
                <div class="loading-indicator__bar" data-loading-bar></div>
            </div>
            <div class="loading-indicator__percent" data-loading-percent>0%</div>
        </div>
    </div>
    <script>
        (function () {
            var storageKey = 'interlinker-theme';
            var root = document.documentElement;
            function setTheme(theme) {
                root.dataset.theme = theme;
                try {
                    localStorage.setItem(storageKey, theme);
                } catch (err) {
                    // Ignore storage failures (e.g., private mode).
                }
            }

            function updateToggle(theme, toggle) {
                if (!toggle) {
                    return;
                }
                var isDark = theme === 'dark';
                toggle.setAttribute('aria-pressed', String(isDark));
                var icon = toggle.querySelector('.icon');
                var label = toggle.querySelector('.label');
                if (icon) {
                    icon.textContent = isDark ? 'üåô' : 'üåû';
                }
                if (label) {
                    label.textContent = isDark ? 'Dark' : 'Light';
                }
            }

            function init() {
                var toggle = document.querySelector('[data-theme-toggle]');
                if (!toggle) {
                    return;
                }

                var currentTheme = root.dataset.theme || 'light';
                setTheme(currentTheme);
                updateToggle(currentTheme, toggle);

                toggle.addEventListener('click', function () {
                    currentTheme = root.dataset.theme === 'dark' ? 'light' : 'dark';
                    setTheme(currentTheme);
                    updateToggle(currentTheme, toggle);
                });

                if (window.matchMedia) {
                    var mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
                    if (mediaQuery.addEventListener) {
                        mediaQuery.addEventListener('change', function (event) {
                            try {
                                if (localStorage.getItem(storageKey)) {
                                    return;
                                }
                            } catch (err) {
                                // ignore
                            }
                            var themeFromSystem = event.matches ? 'dark' : 'light';
                            setTheme(themeFromSystem);
                            updateToggle(themeFromSystem, toggle);
                        });
                    }
                }
            }

            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', init);
            } else {
                init();
            }
        })();
    </script>
    <script>
        (function () {
            function onReady(fn) {
                if (document.readyState === 'loading') {
                    document.addEventListener('DOMContentLoaded', fn);
                } else {
                    fn();
                }
            }

            onReady(function () {
                var indicator = document.getElementById('loading-indicator');
                if (!indicator) {
                    return;
                }

                var bar = indicator.querySelector('[data-loading-bar]');
                var percentLabel = indicator.querySelector('[data-loading-percent]');
                var progressTimer = null;

                function setProgress(value) {
                    var clamped = Math.max(0, Math.min(100, value));
                    if (bar) {
                        bar.style.setProperty('--loading-progress', clamped + '%');
                        bar.style.width = clamped + '%';
                    }
                    if (percentLabel) {
                        percentLabel.textContent = clamped + '%';
                    }
                }

                function startProgress() {
                    clearInterval(progressTimer);
                    var current = 5;
                    setProgress(current);
                    progressTimer = window.setInterval(function () {
                        current += Math.max(1, Math.floor((100 - current) * 0.08));
                        if (current >= 95) {
                            current = 95;
                            clearInterval(progressTimer);
                        }
                        setProgress(current);
                    }, 180);
                }

                function finishProgress() {
                    clearInterval(progressTimer);
                    var current = 95;
                    setProgress(current);
                    progressTimer = window.setInterval(function () {
                        current += 2;
                        if (current >= 100) {
                            current = 100;
                            setProgress(current);
                            clearInterval(progressTimer);
                        } else {
                            setProgress(current);
                        }
                    }, 30);
                }

                function resetProgress() {
                    clearInterval(progressTimer);
                    progressTimer = null;
                    setProgress(0);
                }

                function showIndicator() {
                    indicator.setAttribute('data-active', 'true');
                    indicator.removeAttribute('aria-hidden');
                    startProgress();
                }

                function hideIndicator() {
                    indicator.removeAttribute('data-active');
                    indicator.setAttribute('aria-hidden', 'true');
                    finishProgress();
                    window.setTimeout(resetProgress, 300);
                    document.querySelectorAll('.is-loading').forEach(function (control) {
                        control.disabled = false;
                        control.classList.remove('is-loading');
                        control.removeAttribute('aria-busy');
                    });
                    document.querySelectorAll('form[data-loading-form]').forEach(function (form) {
                        delete form.dataset.loadingActive;
                    });
                }

                var forms = document.querySelectorAll('form[data-loading-form]');
                forms.forEach(function (form) {
                    form.addEventListener('submit', function (event) {
                        if (form.dataset.loadingActive === 'true') {
                            return;
                        }
                        if (event.defaultPrevented) {
                            return;
                        }
                        if (typeof form.checkValidity === 'function' && !form.checkValidity()) {
                            return;
                        }
                        form.dataset.loadingActive = 'true';
                        showIndicator();
                        var controls = form.querySelectorAll('button[type="submit"], input[type="submit"]');
                        controls.forEach(function (control) {
                            control.disabled = true;
                            control.classList.add('is-loading');
                            control.setAttribute('aria-busy', 'true');
                        });
                    });
                });

                window.addEventListener('pageshow', function () {
                    hideIndicator();
                });
            });
        })();
    </script>
    {% block extra_scripts %}{% endblock %}
</body>
</html>
